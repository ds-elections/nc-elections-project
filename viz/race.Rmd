---
title: "race_viz"
author: "Edwin Alvarado"
date: "April 13, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(knitr)
library(forcats)
```

```{r, load data}
if(!dir.exists("viz/temp")) dir.create("viz/temp")
purl("wrangle/cps.Rmd", output = "viz/temp/cps.R") %>% source()
purl("wrangle/nc_wrangle.Rmd", output = "viz/temp/nc.R") %>% source()
purl("tidy_cces/tidy_cces.Rmd", output = "viz/temp/cces.R") %>% source()
```

```{r, tidy cps for viz}
cps$RACE <- as.factor(cps$RACE)
cps$HISPAN <- as.factor(cps$HISPAN)

cps$HISPAN <- fct_other(cps$HISPAN, keep = "Not Hispanic", other_level = "Hispanic")
cps$RACE <- fct_recode(cps$RACE, `Native American` =  "American Indian/Aleut/Eskimo",
                       Asian = "Asian only",
                       Black = "Black American Indian",
                       Mixed = "Black-Asian",
                       Black = "Black/Negro",
                       Other = "Hawaiian/Pacific Islander only",
                       `Native American` = "White-American Indian",
                       Mixed = "White-Asian",
                       Mixed = "White-Black",
                       Mixed = "White-Black-American Indian",
                       Mixed = "White-Black-Asian")

cps%>%
  filter(HISPAN == "Hispanic") %>%
  group_by(RACE, HISPAN) %>%
  summarize(count = n())
```

```{r, test questions?}
#losing 3 in race
cces_2012 %>%
  filter(hispanic == "Yes") %>%
  group_by(race, hispanic) %>%
  summarize(count_hispanic = n())

cces_2012 %>%
  group_by(race) %>%
  summarize(count = n())
```

```{r, 2012}
#this changes people who answered yes to hispanic, to hispanic in race column
cces_2012 <- cces_2012 %>%
  mutate(race = ifelse(hispanic == "Yes", yes = "Hispanic", no = race))
  
cces_2012$race <- as.factor(cces_2012$race)
cces_2012$race <- fct_recode(cces_2012$race, White = "1",
                             Black = "2",
                             Asian = "4",
                             `Native American` = "5",
                             Mixed = "6",
                             Other = "7")
#5 extra people
cces_2012 %>%
group_by(race) %>%
  summarize(count = n())
  

ggplot(cces_2012, aes(x = race)) +
  geom_bar()

```

```{r, 2014}
cces_2014 %>%
  mutate(race = ifelse(hispanic == "Yes", yes = "Hispanic", no = race)) %>%
  ggplot(aes(x = race)) +
  geom_bar()
```

```{r, 2016}
cces_2016 %>%
  mutate(race = ifelse(hispanic == "Yes", yes = "Hispanic", no = race)) %>%
  ggplot(aes(x = race)) +
  geom_bar()
```

